<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OPPS 코인 수령</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="initialScreen" class="max-w-md mx-auto p-6">
        <div class="text-center space-y-4 mb-8">
            <div class="inline-block p-4 bg-blue-50 rounded-full">
                <svg class="h-8 w-8 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
                </svg>
            </div>

            <h1 class="text-2xl font-bold">OPPS 코인 수령</h1>

            <p>MetaMask 지갑이 필요합니다</p>
        </div>

        <button id="connectWallet" class="w-full flex items-center justify-center gap-2 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
            <img src="https://raw.githubusercontent.com/MetaMask/brand-resources/master/SVG/metamask-fox.svg" class="w-6 h-6" alt="MetaMask" />
            지갑 연결하기
        </button>
    </div>

    <div id="metamaskScreen" class="max-w-md mx-auto p-6 hidden">
        <div class="text-center space-y-4 mb-8">
            <div class="inline-block p-4 bg-blue-50 rounded-full">
                <img src="https://raw.githubusercontent.com/MetaMask/brand-resources/master/SVG/metamask-fox.svg" class="h-8 w-8" alt="MetaMask" />
            </div>

            <h1 class="text-2xl font-bold">OPPS 코인 수령</h1>
        </div>

        <div class="space-y-6">
            <div id="metamaskActions" class="space-y-4">
                <button id="openMetamask" class="w-full flex items-center justify-center gap-2 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                    <img src="https://raw.githubusercontent.com/MetaMask/brand-resources/master/SVG/metamask-fox.svg" class="w-6 h-6" alt="MetaMask" />
                    MetaMask 앱으로 이동
                </button>

                <a href="https://metamask.io/download/" target="_blank" class="w-full flex items-center justify-center gap-2 px-4 py-2 border border-gray-300 rounded hover:bg-gray-50">
                    <img src="https://raw.githubusercontent.com/MetaMask/brand-resources/master/SVG/metamask-fox.svg" class="w-6 h-6" alt="MetaMask" />
                    스토어에서 설치하기
                </a>
            </div>

            <div class="relative">
                <div class="absolute inset-0 flex items-center">
                    <div class="w-full border-t border-gray-200"></div>
                </div>
                <div class="relative flex justify-center text-sm">
                    <button id="toggleManual" class="flex items-center gap-1 px-2 bg-gray-50 text-gray-500 hover:text-gray-700">
                        지갑 연결이 안되시나요?
                        <svg class="h-4 w-4 transform transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                        </svg>
                    </button>
                </div>
            </div>

            <div id="manualInputSection" class="hidden space-y-4">
                <div class="bg-white p-4 rounded-lg border border-gray-200 space-y-4">
                    <h3 class="font-medium flex items-center gap-2">
                        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        MetaMask에서 지갑 주소 확인하기
                    </h3>
                    <ol class="space-y-2">
                        <li class="flex items-start gap-2">
                            <span class="flex-shrink-0 w-6 h-6 flex items-center justify-center bg-blue-100 text-blue-600 rounded-full font-medium">1</span>
                            MetaMask 앱을 실행합니다
                        </li>
                        <li class="flex items-start gap-2">
                            <span class="flex-shrink-0 w-6 h-6 flex items-center justify-center bg-blue-100 text-blue-600 rounded-full font-medium">2</span>
                            메인 화면의 계정 주소를 길게 누르거나, 계정 주소를 탭하여 복사합니다
                        </li>
                        <li class="flex items-start gap-2">
                            <span class="flex-shrink-0 w-6 h-6 flex items-center justify-center bg-blue-100 text-blue-600 rounded-full font-medium">3</span>
                            또는 오른쪽 상단 계정 메뉴 (⋮) → 계정 세부정보에서도 확인할 수 있습니다
                        </li>
                    </ol>
                    <p class="text-sm text-gray-500">* 계정 주소는 0x로 시작하는 42자리 문자입니다</p>
                </div>

                <button class="w-full px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                    주소로 연결하기
                </button>
            </div>
        </div>
    </div>

    <script>
        // MetaMask 지갑 연결
        async function connectWallet() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    // MetaMask가 설치되어 있으면 계정 요청
                    const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
                    if (accounts.length > 0) {
                        // 연결 성공
                        document.getElementById('initialScreen').classList.add('hidden');
                        document.getElementById('metamaskScreen').classList.remove('hidden');
                        return accounts[0];
                    }
                } catch (error) {
                    console.error('Error connecting to MetaMask:', error);
                    document.getElementById('initialScreen').classList.add('hidden');
                    document.getElementById('metamaskScreen').classList.remove('hidden');
                }
            } else {
                // MetaMask가 설치되어 있지 않으면 두 번째 화면으로 이동
                document.getElementById('initialScreen').classList.add('hidden');
                document.getElementById('metamaskScreen').classList.remove('hidden');
            }
        }

        // 이벤트 리스너들
        document.getElementById('connectWallet').addEventListener('click', connectWallet);

        document.getElementById('openMetamask').addEventListener('click', async function() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    await ethereum.request({ method: 'eth_requestAccounts' });
                } catch (error) {
                    console.error('Error opening MetaMask:', error);
                }
            }
        });

        document.getElementById('toggleManual').addEventListener('click', function() {
            const manualSection = document.getElementById('manualInputSection');
            const arrow = this.querySelector('svg');
            if (manualSection.classList.contains('hidden')) {
                manualSection.classList.remove('hidden');
                arrow.classList.add('rotate-180');
            } else {
                manualSection.classList.add('hidden');
                arrow.classList.remove('rotate-180');
            }
        });
    </script>
</body>
</html>